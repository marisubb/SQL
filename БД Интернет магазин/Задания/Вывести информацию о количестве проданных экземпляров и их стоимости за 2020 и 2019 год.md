# Вывести информацию о количестве проданных экземпляров и их стоимости за 2020 и 2019 год

## Задание

Для каждой отдельной книги необходимо вывести информацию о количестве проданных экземпляров и их стоимости за
2020 и 2019 год . За 2020 год проданными считать те экземпляры, которые уже оплачены. Вычисляемые столбцы назвать
Количество и Сумма. Информацию отсортировать по убыванию стоимости.
## Фрагмент логической схемы базы данных

![shop14](https://github.com/user-attachments/assets/ffb9d117-fb0c-43b3-8974-9a61ab7915d3)

Информация о продажах предыдущего года хранится в архивной таблице buy_archive, которая создается в конце года на основе информации из таблиц базы данных и имеет следующую структуру:

<img width="1230" height="551" alt="2026-02-05_03-29-43" src="https://github.com/user-attachments/assets/77484947-e7c8-42d9-b1dd-bb7bddac3b22" />

## Решение

```mysql
SELECT title, SUM(Количество) AS Количество, SUM(Сумма) AS Сумма
FROM
(SELECT title, SUM(buy_archive.amount) AS Количество, SUM(buy_archive.price*buy_archive.amount) AS Сумма
FROM buy_archive
    INNER JOIN book USING(book_id)
GROUP BY title, buy_archive.amount
UNION ALL
SELECT title, SUM(buy_book.amount) AS Количество, SUM(book.price*buy_book.amount) AS Сумма
FROM book 
    INNER JOIN buy_book USING(book_id)
    INNER JOIN buy USING(buy_id) 
    INNER JOIN buy_step USING(buy_id)
    INNER JOIN step USING(step_id)                  
WHERE date_step_end IS NOT Null AND name_step = "Оплата"
GROUP BY title, buy_book.amount
ORDER BY Сумма DESC) AS table19_20
GROUP BY title
ORDER BY Сумма DESC;
```

## Результат

<img width="1006" height="368" alt="2026-02-05_03-34-48" src="https://github.com/user-attachments/assets/3ce13f8f-c242-4074-9832-ecffbefa9b52" />

