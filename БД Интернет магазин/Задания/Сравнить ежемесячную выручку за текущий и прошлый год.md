# Сравнить ежемесячную выручку за текущий и прошлый год

## Задание

Сравнить ежемесячную выручку от продажи книг за текущий и предыдущий годы. Для этого вывести год, месяц, сумму 
выручки в отсортированном сначала по возрастанию месяцев, затем по возрастанию лет виде. Название столбцов: Год, Месяц, Сумма.

## Фрагмент логической схемы базы данных

![shop14](https://github.com/user-attachments/assets/ffb9d117-fb0c-43b3-8974-9a61ab7915d3)

Информация о продажах предыдущего года хранится в архивной таблице buy_archive, которая создается в конце года на основе информации из таблиц базы данных и имеет следующую структуру:

<img width="1230" height="551" alt="2026-02-05_03-29-43" src="https://github.com/user-attachments/assets/77484947-e7c8-42d9-b1dd-bb7bddac3b22" />


## Решение

```mysql
SELECT YEAR(date_payment) AS Год, MONTHNAME(date_payment) AS Месяц, SUM(price*amount) AS Сумма
FROM buy_archive
GROUP BY YEAR(date_payment), MONTHNAME(date_payment)
UNION
SELECT YEAR(date_step_end) AS Год, MONTHNAME(date_step_end) AS Месяц, SUM(book.price*buy_book.amount) AS Сумма
FROM 
    book 
    INNER JOIN buy_book USING(book_id)
    INNER JOIN buy USING(buy_id) 
    INNER JOIN buy_step USING(buy_id)
    INNER JOIN step USING(step_id)                  
WHERE  date_step_end IS NOT Null and name_step = "Оплата"
GROUP BY YEAR(date_step_end), MONTHNAME(date_step_end)
ORDER BY Месяц ASC;
```

## Результат

<img width="984" height="307" alt="2026-02-05_03-27-18" src="https://github.com/user-attachments/assets/f4c56a5f-948f-43a8-988f-3eedc87b6998" />

